

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon1.png">
  <link rel="icon" href="/img/favicon1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Peter Pan">
  <meta name="keywords" content="">
  
    <meta name="description" content="第1章 初识Spring Boot，开发社区首页Spring入门IoC：通过管理bean管理一切  IoC就是一个工厂 用户只需要配置bean之间的关系，实例化完全交由spring容器去做。bean的耦合就拆分了。 就是将bean独立出来，用注解来实现一个概括性的关系，这样就比如原来是一个教室里来很多人开会，教室也需要现场布置，所有的都需要重新设计，而IoC提供了会议室的场所，让大家来直接使用，我">
<meta property="og:type" content="article">
<meta property="og:title" content="community-project">
<meta property="og:url" content="http://example.com/2022/11/22/community-project/index.html">
<meta property="og:site_name" content="PPStudy">
<meta property="og:description" content="第1章 初识Spring Boot，开发社区首页Spring入门IoC：通过管理bean管理一切  IoC就是一个工厂 用户只需要配置bean之间的关系，实例化完全交由spring容器去做。bean的耦合就拆分了。 就是将bean独立出来，用注解来实现一个概括性的关系，这样就比如原来是一个教室里来很多人开会，教室也需要现场布置，所有的都需要重新设计，而IoC提供了会议室的场所，让大家来直接使用，我">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://docs.spring.io/spring-framework/docs/current/reference/html/images/container-magic.png">
<meta property="og:image" content="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http-layers.png">
<meta property="og:image" content="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_request.png">
<meta property="og:image" content="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_response.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-22%20at%2020.46.27.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-22%20at%2021.22.10.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-22%20at%2020.49.38.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190919165914553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NTQzNTA4,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-23%20at%2017.39.44.png">
<meta property="og:image" content="https://uploadfiles.nowcoder.com/images/20190807/5175351_1565160382876_814B4F82EEEABAB79579F1CA74D9FEBB">
<meta property="og:image" content="https://uploadfiles.nowcoder.com/images/20190807/5175351_1565160471581_2318FA3D306733D4AAB3163F9F809C1D">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-24%20at%2017.06.27.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-24%20at%2019.53.14.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-24%20at%2020.05.12.png">
<meta property="og:image" content="https://uploadfiles.nowcoder.com/images/20220617/464128859_1655437103918/D2B5CA33BD970F64A6301FA75AE2EB22">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-26%20at%2018.39.27.png">
<meta property="og:image" content="https://camo.githubusercontent.com/605c87538389225ee05159a742522457d1afd3711254a7f50110682e44517024/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f3030386933736b4e6779316772646d7263773231756a33316b36307530316b782e6a7067">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.32.14.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.35.22.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.36.20.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.36.34.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.36.49.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.37.27.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-11-29%20at%2010.40.05.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-01%20at%2017.11.11.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-01%20at%2017.12.06.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-01%20at%2017.17.55.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-06%20at%2017.33.09.png">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/567e4179118647d59f000763a3bc5046~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19b670df6cb54c4ebdc17a114b5dc97c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-08%20at%2015.25.19.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-08%20at%2019.31.17.png">
<meta property="og:image" content="https://uploadfiles.nowcoder.com/images/20190806/5175351_1565065069370_4A47A0DB6E60853DEDFCFDF08A5CA249">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-15%20at%2015.59.00.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-15%20at%2018.40.06.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-16%20at%2013.51.57.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-16%20at%2014.03.51.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-16%20at%2014.16.23.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-16%20at%2014.29.02.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-16%20at%2014.30.11.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-17%20at%2016.59.55.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-17%20at%2017.01.06.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-18%20at%2020.02.08.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-18%20at%2022.40.15.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2010.17.05.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2010.19.12.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2017.05.36.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2017.09.18.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2017.34.05.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2019.31.48.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-19%20at%2019.33.34.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.07.36.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.10.45.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.13.13.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.17.58.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.35.04.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.36.59.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.37.51.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Desktop/Screen%20Shot%202022-12-21%20at%2016.38.34.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.44.29.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.45.53.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.47.26.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.49.08.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.55.40.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.57.51.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2016.58.37.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2017.32.57.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2017.36.27.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2017.38.59.png">
<meta property="og:image" content="http://example.com/Users/peterpan/Library/Application%20Support/typora-user-images/Screen%20Shot%202022-12-21%20at%2017.39.17.png">
<meta property="article:published_time" content="2022-11-22T03:01:35.000Z">
<meta property="article:modified_time" content="2023-03-05T14:28:06.393Z">
<meta property="article:author" content="Peter Pan">
<meta property="article:tag" content="Java-Project">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://docs.spring.io/spring-framework/docs/current/reference/html/images/container-magic.png">
  
  
  <title>community-project - PPStudy</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/banner2.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="community-project">
              
                community-project
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-11-22 11:01" pubdate>
        November 22, 2022 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      30k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      251 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">community-project</h1>
            
            <div class="markdown-body">
              <h1 id="第1章-初识Spring-Boot，开发社区首页"><a href="#第1章-初识Spring-Boot，开发社区首页" class="headerlink" title="第1章 初识Spring Boot，开发社区首页"></a>第1章 初识Spring Boot，开发社区首页</h1><h2 id="Spring入门"><a href="#Spring入门" class="headerlink" title="Spring入门"></a>Spring入门</h2><p>IoC：通过管理bean管理一切</p>
<p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/container-magic.png" srcset="/img/loading.gif" lazyload alt="container magic"></p>
<p>IoC就是一个工厂</p>
<p>用户只需要配置bean之间的关系，实例化完全交由spring容器去做。bean的耦合就拆分了。</p>
<p>就是将bean独立出来，用注解来实现一个概括性的关系，这样就比如原来是一个教室里来很多人开会，教室也需要现场布置，所有的都需要重新设计，而IoC提供了会议室的场所，让大家来直接使用，我只需要让spring扫描器扫到需要参会（用@component等注解）的bean就完成一场会议的布置了。</p>
<p>Spring容器的顶层接口是BeanFactory，而常用的是其子接口ApplicationContext</p>
<p>通过注解还可以自定义bean的名字。</p>
<p>初始化一般都在构造后调用 @PostConstruct，在销毁对象之前调用@PreDestroy</p>
<p>默认单例的，bean只被创建一次，被销毁一次（跟随spring容器），应该是bean的生命周期。@Scope（${}）默认是single，然后设置成prototype就会在你每次访问bean的时候都创建一个。基本都是单例的。</p>
<p>@Configuration配置类，里面定义第三方bean，用@Bean注解。方法名就是bean的名字。这种方式很笨拙这是主动获取，现在都是直接注入依赖。</p>
<figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlphaConfig</span> &#123;<br>  <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-keyword">public</span> simpleDataFormat <span class="hljs-title function_">simpleDateFormat</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>现在就是直接用@Autowired 注解，这种就是依赖注入。不需要原来的下面这种方式来通过bean名字先获取bean对象，然后再使用它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">applicationContext.getBean($&#123;bean名字&#125;)<br></code></pre></td></tr></table></figure>
<p>如果重名了，就加入@Qualifier(${bean名字})来区分。</p>
<h2 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h2><p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http-layers.png" srcset="/img/loading.gif" lazyload alt="HTTP as an application layer protocol, on top of TCP (transport layer) and IP (network layer) and below the presentation layer."></p>
<p><strong>HTTP请求</strong></p>
<p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_request.png" srcset="/img/loading.gif" lazyload alt="A basic HTTP request"></p>
<p><strong>HTTP响应</strong></p>
<p><img src="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview/http_response.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><strong>SpringMVC数据流图</strong></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-22 at 20.46.27.png" srcset="/img/loading.gif" lazyload alt="SpringMVC"></p>
<p>springmvc可以返回字符串、html、json</p>
<p><strong>Thymeleaf</strong></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-22 at 21.22.10.png" srcset="/img/loading.gif" lazyload alt="Thymeleaf例子"></p>
<p>模版引擎：生成动态的HTML。</p>
<p>Thymeleaf：倡导自然模版，即以HTML文件为模版。</p>
<p>常用语法：标准表达式、判断与循环、模版的布局。</p>
<p>默认是启动缓存的，开发的时候，关掉要不不会及时响应。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-22 at 20.49.38.png" srcset="/img/loading.gif" lazyload alt="模版引擎"></p>
<p><code>@ResponseBody</code>是作用在方法上的，@ResponseBody<strong>表示该方法的返回结果直接写入HTTPresponsebody中，一般在异步获取数据时使用（也就是AJAX）</strong></p>
<p><code>@RequestParam</code> 注解的<code>value</code> 属性值没有对应上jsp中<code>name</code> 值则会直接报<strong>400错误</strong>，因为<code>required</code> 属性默认为<code>true</code> ，如果加上<code>required=false</code> ，没对应上则不会报错，而是获取值为<code>null</code> 。</p>
<p>属性</p>
<ol>
<li>value / name：请求参数中的名称 （必写参数）</li>
<li>required：请求参数中是否必须提供此参数，默认值是true，true为必须提供</li>
<li>defaultValue：默认值</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20190919165914553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NTQzNTA4,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="@RequestMapping描述"></p>
<p><code>@PathVariable</code>注解同理上图，但前面mapping里面路径不一样得写”/test/{id}”</p>
<p><strong>响应Json数据（异步请求）</strong></p>
<p>当前网页不刷新，但后台发出请求，比如验证昵称是否使用过。</p>
<p>Java对象 -&gt; JSON字符串 -&gt; JS对象 </p>
<p><strong>作业：</strong></p>
<p>HTTP是基于TCP连接的。</p>
<p>SpringMVC在表现层，MVC单指的那三层。</p>
<h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><p><strong>核心组件</strong></p>
<p>SqlSessionFactory：用于创建sqlSession的工厂类。</p>
<p>SqlSession：MyBatis的核心组件，用于向数据库执行SQL。</p>
<p>主配置文件：XML配置文件，可以对MyBatis的底层行为作出详细的配置。</p>
<p>（以上三个会被Spring自己整合。）</p>
<p>Mapper接口：就是Dao接口，在MyBatis中习惯性的称之为Mapper。</p>
<p>Mapper映射器：用于编写SQL，并将SQL和实体类映射的组件，采用XML，注解均可实现。</p>
<p><strong>配置信息</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># DataSourceProperties</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Hongkong</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">lihonghe</span><br><span class="hljs-attr">spring.datasource.type</span>=<span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br><span class="hljs-attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="hljs-string">15</span><br><span class="hljs-attr">spring.datasource.hikari.minimum-idle</span>=<span class="hljs-string">5</span><br><span class="hljs-attr">spring.datasource.hikari.idle-timeout</span>=<span class="hljs-string">30000</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># MybatisProperties</span><br><span class="hljs-attr">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:mapper/*.xml</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">com.nowcoder.community.entity</span><br><span class="hljs-attr">mybatis.configuration.useGeneratedKeys</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">mybatis.configuration.mapUnderscoreToCamelCase</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.datasource.type</span>=<span class="hljs-string">&#123;连接池的类型&#125;</span><br><span class="hljs-attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="hljs-string">&#123;连接池的大小&#125;</span><br><span class="hljs-attr">spring.datasource.hikari.minimum-idle</span>=<span class="hljs-string">&#123;最小连接池保留数&#125;</span><br><span class="hljs-attr">spring.datasource.hikari.idle-timeout</span>=<span class="hljs-string">&#123;超时时间单位ms&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># MybatisProperties</span><br><span class="hljs-attr">mybatis.mapper-locations</span>=<span class="hljs-string">&#123;存放xml文件的位置&#125;</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">&#123;实体类所在的包名&#125;</span><br><span class="hljs-attr">mybatis.configuration.useGeneratedKeys</span>=<span class="hljs-string">&#123;启用自增主键&#125;</span><br><span class="hljs-attr">mybatis.configuration.mapUnderscoreToCamelCase</span>=<span class="hljs-string">&#123;true 表示让驼峰命名和表里的字段匹配，比如 a_bc 等于 aBC&#125;</span><br></code></pre></td></tr></table></figure>
<p>如果不是java自带的类型就</p>
<p><code>parameterType=&quot;User&quot;</code>声明出来</p>
<p><strong>作业：</strong></p>
<p>SqlSession，用户向数据库执行SQL语句。</p>
<h2 id="开发社区首页"><a href="#开发社区首页" class="headerlink" title="开发社区首页"></a>开发社区首页</h2><p><strong>开发流程：</strong></p>
<p>1次请求的执行过程</p>
<p><strong>分步实现：</strong></p>
<p>开发社区首页，显示前10个帖子</p>
<p>开发分页组件，分页显示所有的帖子</p>
<p>@Param(“{变量}”) 用于给参数取别名</p>
<p><code>&lt;if test=&quot;userId!=0&quot;&gt;</code> 就是个判断 test是参数。一定要分清参数和字段谁是谁。</p>
<p>userId为0代表不使用userId作为参数</p>
<p><code>th:href=&quot;@&#123;$&#123;page.path&#125;(current=1,limit=5)&#125;</code>等价与 xxx/?current=1&amp;limit=5</p>
<h2 id="项目调试技巧"><a href="#项目调试技巧" class="headerlink" title="项目调试技巧"></a>项目调试技巧</h2><ul>
<li>响应状态码含义</li>
<li>服务端断点调试技巧</li>
<li>客户端断点调试技巧</li>
</ul>
<p>​        在浏览器里面打断点</p>
<ul>
<li>设置日志级别，并将日志输出到不同的终端</li>
</ul>
<p><strong>重定向</strong></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-23 at 17.39.44.png" srcset="/img/loading.gif" lazyload alt="重定向"></p>
<p><strong>日志级别</strong></p>
<p>trace &lt; debug &lt; info &lt; warn &lt; error</p>
<h2 id="Git-版本控制"><a href="#Git-版本控制" class="headerlink" title="Git 版本控制"></a>Git 版本控制</h2><p><strong>本地仓库管理</strong>：</p>
<p>先进入工作目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init <span class="hljs-comment"># 初始化本地仓库</span><br>git status <span class="hljs-comment"># 查看状态</span><br>git add * &#123;文件夹路径&#125; <span class="hljs-comment"># 添加文件夹，再查看状态发现临时存在仓库</span><br>git commit -m <span class="hljs-string">&#x27;&#123;描述内容&#125;&#x27;</span> <span class="hljs-comment"># -m为添加描述内容</span><br></code></pre></td></tr></table></figure>
<p><strong>远程仓库管理</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin &#123;url以.git结尾&#125; <span class="hljs-comment"># 创建远程仓库</span><br>git push -u origin master<br>...<br></code></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>主要是有一个分页的知识，是通过mybatis自带的分页功能实现的，标记好offset和limit（起始和数量）就能实现</p>
<h1 id="第2章-Spring-Boot实践，开发社区登录模块"><a href="#第2章-Spring-Boot实践，开发社区登录模块" class="headerlink" title="第2章 Spring Boot实践，开发社区登录模块"></a>第2章 Spring Boot实践，开发社区登录模块</h1><h2 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h2><p><strong>邮箱设置</strong>：</p>
<p>​    启动客户端SMTP服务</p>
<p><strong>Spring Email</strong>：</p>
<p>​    导入 jar 包</p>
<p>​    邮箱参数配置</p>
<p>​    使用 JavaMailSender 发送邮件</p>
<p><strong>模版引擎</strong>：</p>
<p>​    使用 Thymeleaf 发送 HTML 邮件</p>
<p><strong>@Value注解</strong></p>
<p>@Value的值有两类：<br>① ${ property : default_value }<br>② #{ obj.property? :default_value }<br>第一个注入的是外部配置文件对应的property，第二个则是SpEL表达式对应的内容。 那个<br>default_value，就是前面的值为空时的默认值。注意二者的不同，#{}里面那个obj代表对象。</p>
<p><strong>关于发送不了邮件的说明</strong><br>新浪邮箱目前做了改进，改进了发送邮件客户端的验证方式，现在需要通过授权码才能发送邮件了，具体说明如下：</p>
<ol>
<li><p>首先，你要在邮箱设置里启用授权码，如下图:<br><img src="https://uploadfiles.nowcoder.com/images/20190807/5175351_1565160382876_814B4F82EEEABAB79579F1CA74D9FEBB" srcset="/img/loading.gif" lazyload alt="图片说明"></p>
</li>
<li><p>点击开启时，会要求验证手机，验证通过后，会弹出弹出一个框，提示授权码，如下图：<br><img src="https://uploadfiles.nowcoder.com/images/20190807/5175351_1565160471581_2318FA3D306733D4AAB3163F9F809C1D" srcset="/img/loading.gif" lazyload alt="图片说明"></p>
</li>
<li><p>修改application.properties中关于Email的配置，弃用密码，改用授权码，peizh代码如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># MailProperties</span><br><span class="hljs-attr">spring.mail.host</span>=<span class="hljs-string">smtp.sina.com</span><br><span class="hljs-comment">#spring.mail.port=465</span><br><span class="hljs-attr">spring.mail.username</span>=<span class="hljs-string">nowcoder@sina.com</span><br><span class="hljs-attr">spring.mail.password</span>=<span class="hljs-string">3398c6c71399f9fe</span><br><span class="hljs-comment">#spring.mail.protocol=smtps</span><br><span class="hljs-comment">#spring.mail.properties.mail.smtp.ssl.enable=true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtl.auth</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.enable</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.required</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure>
<p>最后，首次启用新浪邮箱SMTP服务时，它会自动启用授权码。对于qq邮箱和163邮箱，也是采用这种授权方案。</p>
</li>
</ol>
<h2 id="开发注册功能"><a href="#开发注册功能" class="headerlink" title="开发注册功能"></a>开发注册功能</h2><p><strong>访问注册页面</strong></p>
<p>​    点击顶部区域内的链接，打开注册页面。</p>
<p><strong>提交注册数据</strong></p>
<p>​    通过表单提交数据。</p>
<p>​    服务端验证账号是否已存在、邮箱是否已注册。</p>
<p>​    服务端发送激活邮件。</p>
<p><strong>激活注册账号</strong></p>
<p>​    点击右键中的链接，访问服务端的激活服务。</p>
<p>Common lang包做数据验证</p>
<p>网络安全：</p>
<p>MD5加密，单纯的单向加密无意义，加上盐以后随机数无法破解其密码。</p>
<p><code>context.setVariable(&quot;url&quot;, url);</code>拼接属性值。</p>
<p>@PathVariable 来获取路径中的值</p>
<p>mail可能被屏蔽所以我们看视频记流程 <a target="_blank" rel="noopener" href="https://www.nowcoder.com/study/live/246/2/7">https://www.nowcoder.com/study/live/246/2/7</a></p>
<p>小总结：验证账号 + 验证邮箱</p>
<h2 id="会话管理"><a href="#会话管理" class="headerlink" title="会话管理"></a>会话管理</h2><p>HTTP的基本性质：</p>
<p>​    HTTP是简单的</p>
<p>​    HTTP是可扩展的</p>
<p>​    HTTP是无状态的，有会话的（同一个服务器发出多个请求给另外一个服务器，别的服务器也无法记录身份，无状态）</p>
<p>Cookie</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-24 at 17.06.27.png" srcset="/img/loading.gif" lazyload alt="cookie"></p>
<p>​    是服务器发送到浏览器，并保存在浏览器端的一小块数据</p>
<p>​    浏览器下次访问该服务器时，会自动携带该数据，将其发送给服务器</p>
<p>Session</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-24 at 19.53.14.png" srcset="/img/loading.gif" lazyload alt="session"></p>
<p>​    是JavaEE的标准，用于在服务端记录客户端信息</p>
<p>​    数据存放在服务端更加安全，但是也会增加服务端的内存压力</p>
<p>​    session可以存一些信息请求的时候set，get的时候直接拿这个数据</p>
<p><strong>分布式部署的时候session没有办法一致性，怎么办？</strong></p>
<p>粘性session：就是谁给的session，只请求谁，绑定了</p>
<p>同步session：分布式服务器同步session</p>
<p>共享session：搞一台服务器专门搞session，但是单体服务器的问题暴露无遗。</p>
<p>cookie是明文的，session是加密的。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-24 at 20.05.12.png" srcset="/img/loading.gif" lazyload alt="会话管理"></p>
<p>通过<code>@CookieValue(&quot;ticket&quot;) String ticket</code>让服务端拿到cookie</p>
<h2 id="生成验证码"><a href="#生成验证码" class="headerlink" title="生成验证码"></a>生成验证码</h2><p>Kaptcha</p>
<p>​    导入jar包</p>
<p>​    编写Kaptcha配置类</p>
<p>​    生成随机字符、生成图片</p>
<p>我个人觉得他访问的速度还是慢了，主要是第一次访问，不知道是不是浏览器访问的问题。</p>
<h2 id="开发登陆、退出功能"><a href="#开发登陆、退出功能" class="headerlink" title="开发登陆、退出功能"></a>开发登陆、退出功能</h2><p>访问登陆页面</p>
<p>​    点击顶部区域内的链接，打开登陆页面。</p>
<p>登陆</p>
<p>​    验证账号、密码、验证码。</p>
<p>​    成功时，生成登陆凭证，发放给客户端。</p>
<p>​    失败时，跳转回登陆页。</p>
<p>退出</p>
<p>​    将登陆凭证修改为失效状态。</p>
<p>​    跳转至网站首页。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> login_ticket<br>(<br>    id      <span class="hljs-type">int</span> auto_increment<br>        <span class="hljs-keyword">primary</span> key,<br>    user_id <span class="hljs-type">int</span>           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    ticket  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>)   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    status  <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;0-有效; 1-无效;&#x27;</span>,<br>    expired <span class="hljs-type">timestamp</span>     <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>)<br></code></pre></td></tr></table></figure>
<p>0为有效。</p>
<p>这个ticket类似于session。</p>
<p>服务端存储session结构，然后发送cookie给客户端。session包含了验证码，在获取验证码的时候已经存储在了session里面。</p>
<p>这里map作为返回值呢，不太准确其实现在都是用json，但结果是一样的不太重要。</p>
<p>ticket作为cookie存在于浏览器中，所以每次刷新都会保证自己的登陆状态。</p>
<p>model不会自动装配基本类型。</p>
<p>先判断验证码，这样也会降低后台sql的压力。</p>
<p>注解形式的insert中, @option为什么还要加属性useGenerateKeys=true, application.properties中已经声明了如下配置.  还是说配置文件中的配置对注解形式的sql不生效啊 </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">mybatis.configuration.useGeneratedKeys</span>=<span class="hljs-string">true       </span><br></code></pre></td></tr></table></figure>
<p>这项配置对注解形式的SQL是无效的。</p>
<p>转发解决的的一次请求内部的跳转，重定向解决的是2次请求之间的跳转。</p>
<p>简单讲一下登陆成功后为什么重定向到首页的问题吧。大家先看图：<img src="https://uploadfiles.nowcoder.com/images/20220617/464128859_1655437103918/D2B5CA33BD970F64A6301FA75AE2EB22" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>重定向就是尽量满足固定请求对应固定的定向网页，也就是login只负责login返回的不是视图而是cookie，index只负责index，重定向就是两次请求做一个中转。一般是在变换你要访问的页面时候用到重定向，要不对一个请求就写死了，复用性太差。</p>
<p><strong>忘记密码的安全问题</strong></p>
<p>验证码存在共享问题(且不论啥分布式session同步不同步) </p>
<p>问题描述：忘记密码页面中，输入邮箱A，获取验证码；此时将邮箱改为B，输入邮箱A获取的验证码，此时可以修改密码 </p>
<p>此处问题主要在于LoginController.java下，getForgetCode方法和resetPassword方法中，存与取验证码都是基于seesion的key(“verifyCode”)，未作用户区分，简单进行修改即可，比如 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">getForgetCode方法下，``原为session.setAttribute(``<span class="hljs-string">&quot;verifyCode&quot;</span>``, code);``改为session.setAttribute(email+``<span class="hljs-string">&quot;_verifyCode&quot;</span>``, code);` `resetPassword方法下``原为<span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> (String) session.getAttribute(``<span class="hljs-string">&quot;verifyCode&quot;</span>``);``改为<span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> (String) session.getAttribute(email+``<span class="hljs-string">&quot;_verifyCode&quot;</span>``);<br></code></pre></td></tr></table></figure>
<p>这样的话别人就可以随意改动我的密码了，只需要知道我的注册邮箱我的号就没了。</p>
<h2 id="显示登录信息"><a href="#显示登录信息" class="headerlink" title="显示登录信息"></a>显示登录信息</h2><p>拦截器示例</p>
<p>​    定义拦截器，实现HandlerInterceptor</p>
<p>​    配置拦截器，为它制定拦截、排除的路径</p>
<p>拦截器应用</p>
<p>​    在请求开始时查询登陆用户</p>
<p>​    在本次请求中持有用户数据</p>
<p>​    在模版视图上显示用户数据</p>
<p>​    在请求结束时清理用户数据</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-26 at 18.39.27.png" srcset="/img/loading.gif" lazyload alt="登录信息流程"></p>
<p>存ticket只是key也就是userid并不敏感，如果裸露user信息就很敏感。</p>
<p><strong>拦截器</strong>将很多service或者Controller中共有的行为提炼出来，在某些方法执行的前后执行，提炼为通用的处理方式，让被<strong>拦截</strong>的方法都能享受这一共有的功能，让代码更加简洁，同时，当共有的功能需要发生调整、变动的时候，不必修改很多的类或者方法，只要修改这个<strong>拦截器</strong>就可以了，可复<strong>用</strong>性很强。</p>
<p>ThreadLocal，在多线程中隔离对象，分配给每个线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread(); <span class="hljs-comment">//获取当前线程</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>            map.set(<span class="hljs-built_in">this</span>, value);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            createMap(t, value);<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread(); <span class="hljs-comment">//获取当前线程</span><br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;<br>                <span class="hljs-keyword">return</span> result;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> setInitialValue();<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>通过取得当前线程后再操作实现线程隔离。都存在当前线程的一个map里面。</p>
<p>这个功能最后出口出去给模版的类叫loginUser</p>
<h2 id="账号设置"><a href="#账号设置" class="headerlink" title="账号设置"></a>账号设置</h2><p>上传文件</p>
<p>​    请求：必须是POST请求</p>
<p>​    表单：enctype= “multipart/form-data”</p>
<p>​    Spring MVC：通过MultipartFile处理上传文件</p>
<p>开发步骤</p>
<p>​    访问账号设置页面</p>
<p>​    上传头像</p>
<p>​    获取头像</p>
<p>学习到输入输出流相关的知识</p>
<p>课后作业完成修改密码(完成)</p>
<p>空值处理、验证密码、更新密码</p>
<p>没有前端校验 新密码是两次输入一样的。</p>
<p>还有忘记密码功能</p>
<p>忘记密码</p>
<h2 id="检查登陆状态"><a href="#检查登陆状态" class="headerlink" title="检查登陆状态"></a>检查登陆状态</h2><p>使用拦截器</p>
<p>​    在方法前标注自定义注解</p>
<p>​    拦截所有请求，只处理带有该注解的方法</p>
<p>自定义注解</p>
<p>​    常用的元注解：</p>
<p>​    @Target（作用目标）、@Retention（有效时间）、@Document（生成文档带不带）、@Inherited（子类是否继承注解）</p>
<p>​    <strong>前两个</strong>几乎必用。</p>
<p>​    如何读取注解：</p>
<p>​    Method.getDeclaredAnnotations()</p>
<p>​    Method.getAnnotation(Class<T> annotationClass)</p>
<p>如果没有设置拦截器，那么就会造成（非登陆状态）我直接输入url可以访问登陆状态下的网页。</p>
<p>注解可以作为一种标志。</p>
<p>HostHolder是一个bean它在拦截器的时候被实例化，然后一直存在于服务器中，相当于一种本地的用户缓存吧。</p>
<p><strong>拦截器执行顺序是按照Spring配置文件中定义的顺序而定的。</strong></p>
<p>洋葱模型应该是。</p>
<p>关于重定向：</p>
<p>在controller方法里，通过返回以redirect开头的字符串实现重定向</p>
<p>在拦截器中，通过response对象的sendRedirect方法实现重定向</p>
<h1 id="第3章-Spring-Boot实践，开发社区核心功能"><a href="#第3章-Spring-Boot实践，开发社区核心功能" class="headerlink" title="第3章 Spring Boot实践，开发社区核心功能"></a>第3章 Spring Boot实践，开发社区核心功能</h1><h2 id="敏感词过滤"><a href="#敏感词过滤" class="headerlink" title="敏感词过滤"></a>敏感词过滤</h2><p>过滤敏感词</p>
<p>​    名称：Trie、字典树、查找树</p>
<p>​    特点：查找效率高，消耗内存大</p>
<p>​    应用：字符串检索、词频统计、字符串排序等</p>
<p>敏感词过滤器</p>
<p>​    定义前缀树</p>
<p>​    根据敏感词，初始化前缀树</p>
<p>​    编写过滤敏感词的方法</p>
<p>前缀树：根节点是空的，然后其余节点只有一个字符。每个节点包含的子节点都不同，相同则合并。</p>
<p>原理图：</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/605c87538389225ee05159a742522457d1afd3711254a7f50110682e44517024/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f3030386933736b4e6779316772646d7263773231756a33316b36307530316b782e6a7067"><img src="https://camo.githubusercontent.com/605c87538389225ee05159a742522457d1afd3711254a7f50110682e44517024/68747470733a2f2f747661312e73696e61696d672e636e2f6c617267652f3030386933736b4e6779316772646d7263773231756a33316b36307530316b782e6a7067" srcset="/img/loading.gif" lazyload alt="image-20210611002057898"></a></p>
<p><strong>@PostConstruct注解：</strong></p>
<p>该注解是Java jdk提供的注解，而不是Spring框架提供的， JavaEE5引入了@PostConstruct和@PreDestroy两个作用于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Servlet&amp;spm=1001.2101.3001.7020">Servlet</a>生命周期的注解，实现Bean初始化之前和销毁之前的自定义操作。</p>
<h2 id="发布帖子"><a href="#发布帖子" class="headerlink" title="发布帖子"></a>发布帖子</h2><p>AJAX</p>
<p>​    Asynchronous JavaScript and XML</p>
<p>​    异步的JavaScript与XML，不是一门新技术，只是一个新的术语</p>
<p>​    使用AJAX，网页能够将增量更新呈现在页面上，而不需要刷新整个页面</p>
<p>​    虽然X代表XML，但目前JSON的使用比XML更加普遍</p>
<p>示例</p>
<p>​    使用JQury发送AJAX请求</p>
<p>实践</p>
<p>​    采用AJAX请求，实现发布帖子的功能</p>
<p>发之前要进行敏感词过滤。</p>
<p>理解AJAX请求，其实就是前后端分离的前身，通过一个json对象的信息来判断状态，没有数据的时候是靠点击事件来切换的。</p>
<h2 id="帖子详情"><a href="#帖子详情" class="headerlink" title="帖子详情"></a>帖子详情</h2><p>DiscussPostMapper</p>
<p>DiscussPostService</p>
<p>DiscussPostController</p>
<p>index.html</p>
<p>​    在帖子标题上增加访问详情页面的链接</p>
<p>discuss-detail.html</p>
<p>​    处理静态资源的访问路径</p>
<p>​    复用index.html的header区域</p>
<p>​    显示标题、作者、发布时间、帖子正文等内容</p>
<p>查询可以两种方式：联合查询 or 先查对象1再根据对象1的id查找对象2</p>
<p>用redis来解决效率问题</p>
<p>分页如何实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">page.setLimit(<span class="hljs-number">5</span>);<br>page.setPath(<span class="hljs-string">&quot;/discuss/detail/&quot;</span> + discussPostId);<br>page.setRows(post.getCommentCount());<br></code></pre></td></tr></table></figure>
<p>通过设置路径+id来分开每个页的请求地址，这样一个页一个请求地址数据可以隔离开。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">@&#123;|/discuss/detail/$&#123;map.post.id&#125;|&#125;<br></code></pre></td></tr></table></figure>
<p>通过这样来链接对应的post。然后如何和前端呼应呢，就是如果把page作为一个参数，那么java bean自动装配其进入model。然后具体从哪条开始就是前端传进来的，current通过page元素里面的相应方法来获取起始页。</p>
<p>然后mapper会筛选类型然后再在纯净的数据里面进行按照page的参数limit和offset进行筛选。</p>
<p>总结：前端传来起始id、后端设置好了limit然后通过mapper查询回馈结果给前端VO实体、前端展示所有的VO实体</p>
<h2 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h2><p>事务的隔离性：</p>
<p>​    常见的并发异常：</p>
<p>​        第一类丢失更新（回滚丢失更新）、第二类丢失更新（晚提交丢失更新）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.32.14.png" srcset="/img/loading.gif" lazyload alt="第一类丢失更新"></p>
<p>​        <img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.35.22.png" srcset="/img/loading.gif" lazyload alt="第二类丢失更新"></p>
<p>​        脏读、不可重复读、幻读</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.36.20.png" srcset="/img/loading.gif" lazyload alt="脏读"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.36.34.png" srcset="/img/loading.gif" lazyload alt="不可重复读"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.36.49.png" srcset="/img/loading.gif" lazyload alt="幻读"></p>
<p>常见的隔离级别：</p>
<p>​        Read Uncommitted：读未提交</p>
<p>​        Read Committed: 读已提交</p>
<p>​        Repeatable Read：可重复读</p>
<p>​        Serializable：串行化</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.37.27.png" srcset="/img/loading.gif" lazyload alt="实现机制"></p>
<p>共享锁就是读锁、排他锁就是写锁。</p>
<p>悲观就是默认有问题，所以在开始读写数据之前就判断；乐观锁就是不默认有问题，在事务结束的时候看数据的版本号是否改变再更新数据。</p>
<p><strong>Spring事务管理</strong></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-11-29 at 10.40.05.png" srcset="/img/loading.gif" lazyload alt="Spring事务管理"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 声明式事务		</span><br>		<span class="hljs-comment">// REQUIRED: 支持当前事务(外部事务),如果不存在则创建新事务.</span><br>    <span class="hljs-comment">// REQUIRES_NEW: 创建一个新事务,并且暂停当前事务(外部事务).</span><br>    <span class="hljs-comment">// NESTED: 如果当前存在事务(外部事务),则嵌套在该事务中执行(独立的提交和回滚),否则就会REQUIRED一样.</span><br>    <span class="hljs-meta">@Transactional(isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">save1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 新增用户</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setUsername(<span class="hljs-string">&quot;alpha&quot;</span>);<br>        user.setSalt(CommunityUtil.generateUUID().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br>        user.setPassword(CommunityUtil.md5(<span class="hljs-string">&quot;123&quot;</span> + user.getSalt()));<br>        user.setEmail(<span class="hljs-string">&quot;alpha@qq.com&quot;</span>);<br>        user.setHeaderUrl(<span class="hljs-string">&quot;http://image.nowcoder.com/head/99t.png&quot;</span>);<br>        user.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        userMapper.insertUser(user);<br><br>        <span class="hljs-comment">// 新增帖子</span><br>        <span class="hljs-type">DiscussPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiscussPost</span>();<br>        post.setUserId(user.getId());<br>        post.setTitle(<span class="hljs-string">&quot;Hello&quot;</span>);<br>        post.setContent(<span class="hljs-string">&quot;新人报道!&quot;</span>);<br>        post.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        discussPostMapper.insertDiscussPost(post);<br><br>        Integer.valueOf(<span class="hljs-string">&quot;abc&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;<br><br><span class="hljs-comment">// 编程式事务		</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">save2</span><span class="hljs-params">()</span> &#123;<br>        transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_COMMITTED);<br>        transactionTemplate.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);<br><br>        <span class="hljs-keyword">return</span> transactionTemplate.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionCallback</span>&lt;Object&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doInTransaction</span><span class="hljs-params">(TransactionStatus status)</span> &#123;<br>                <span class="hljs-comment">// 新增用户</span><br>                <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>                user.setUsername(<span class="hljs-string">&quot;beta&quot;</span>);<br>                user.setSalt(CommunityUtil.generateUUID().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br>                user.setPassword(CommunityUtil.md5(<span class="hljs-string">&quot;123&quot;</span> + user.getSalt()));<br>                user.setEmail(<span class="hljs-string">&quot;beta@qq.com&quot;</span>);<br>                user.setHeaderUrl(<span class="hljs-string">&quot;http://image.nowcoder.com/head/999t.png&quot;</span>);<br>                user.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                userMapper.insertUser(user);<br><br>                <span class="hljs-comment">// 新增帖子</span><br>                <span class="hljs-type">DiscussPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiscussPost</span>();<br>                post.setUserId(user.getId());<br>                post.setTitle(<span class="hljs-string">&quot;你好&quot;</span>);<br>                post.setContent(<span class="hljs-string">&quot;我是新人!&quot;</span>);<br>                post.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                discussPostMapper.insertDiscussPost(post);<br><br>                Integer.valueOf(<span class="hljs-string">&quot;abc&quot;</span>);<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>            &#125;<br>        &#125;);<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>事务在service层。业务逻辑的层。</p>
<h2 id="显示评论"><a href="#显示评论" class="headerlink" title="显示评论"></a>显示评论</h2><p>数据层</p>
<p>​        根据实体查询一页评论数据</p>
<p>​        根据实体查询评论的数量</p>
<p>业务层</p>
<p>​        处理查询评论的业务</p>
<p>​        处理查询评论数量的业务</p>
<p>表现层</p>
<p>​        显示帖子详情数据时，同时显示该帖子所有的评论数据</p>
<p>评论抽象，如何划分功能呢，用一个 entity_type 和 entity_id 来分开不同的模块。entity_type代表帖子、课程等等不同模块。entity_id 代表具体为228的帖子还是具体为231的课程编号，是抽象的思想。</p>
<p>target_id是评论某个评论</p>
<p>Vo为 view object 显示对象。</p>
<p>说实话很离谱<code>User target = reply.getTargetId() == 0 ? null : userService.findUserById(reply.getTargetId());</code>既然都是回复了，为什么还可能存在找不到目标用户啊？？？因为业务里面有三种评论：评论帖子、评论评论、评论某人</p>
<p>这个就是scan评论的list<code>th:each=&quot;cvo:$&#123;comments&#125;&quot;</code>后面我只需要写好一个模版按照调用cvo的各种属性就能展示了</p>
<h2 id="添加评论"><a href="#添加评论" class="headerlink" title="添加评论"></a>添加评论</h2><p>数据层</p>
<p>​    增加评论数据</p>
<p>​    修改帖子的评论数量</p>
<p>业务层</p>
<p>​    处理增加评论的业务</p>
<p>​    先增加评论、再更新帖子的评论数量（事务）</p>
<p>表现层</p>
<p>​    处理添加评论数据的请求</p>
<p>​    设置添加评论的表单</p>
<p>HtmlUtils.htmlEscape转义html</p>
<p><strong>Redirect</strong></p>
<p>重定向是指当浏览器请求一个URL时，服务器返回一个重定向指令，告诉浏览器地址已经变了，麻烦使用新的URL再重新发送新请求。</p>
<p>根本就是为了重新发送一个请求，这样可以刷新数据。</p>
<h2 id="私信列表"><a href="#私信列表" class="headerlink" title="私信列表"></a>私信列表</h2><p>私信列表</p>
<p>​    查询当前用户的会话列表，每个会话只显示一条最新的私信</p>
<p>​    支持分页显示</p>
<p>私信详情(具体会话的内容)</p>
<p>​    查询某个会话所包含的私信</p>
<p>​    支持分页显示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> message<br>(<br>    id              <span class="hljs-type">int</span> auto_increment<br>        <span class="hljs-keyword">primary</span> key,<br>    from_id         <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span>,<br>    to_id           <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span>,<br>    conversation_id <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    content         text        <span class="hljs-keyword">null</span>,<br>    status          <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;0-未读;1-已读;2-删除;&#x27;</span>,<br>    create_time     <span class="hljs-type">timestamp</span>   <span class="hljs-keyword">null</span><br>)<br></code></pre></td></tr></table></figure>
<p>conversation_id字段保持小序号在前，这样可以保证这是同一会话不会出现111_112，112_111</p>
<p>from_id != 1 是因为等于1的情况为点赞等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>&quot;selectConversations&quot; resultType<span class="hljs-operator">=</span>&quot;Message&quot;<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">select</span> <span class="hljs-operator">&lt;</span>include refid<span class="hljs-operator">=</span>&quot;selectFields&quot;<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>include<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">from</span> message<br>        <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<br>        <span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">from</span> message<br>        <span class="hljs-keyword">where</span> status <span class="hljs-operator">!=</span> <span class="hljs-number">2</span><br>        <span class="hljs-keyword">and</span> from_id <span class="hljs-operator">!=</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">and</span> (from_id <span class="hljs-operator">=</span> #&#123;userId&#125; <span class="hljs-keyword">or</span> to_id <span class="hljs-operator">=</span> #&#123;userId&#125;)<br>        <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> conversation_id<br>        )<br>        <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id <span class="hljs-keyword">desc</span><br>        limit #&#123;<span class="hljs-keyword">offset</span>&#125;, #&#123;limit&#125;<br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里group by是降重，conversation_id代表不同的对话框，然后max(id)一搭配就是不同对话框下的最大id，然后外层再根据id的降序（时间排序）来找到最新的消息显示在最上面。</p>
<h2 id="发送私信"><a href="#发送私信" class="headerlink" title="发送私信"></a>发送私信</h2><p>发送私信</p>
<p>​    采用异步的方式发送私信</p>
<p>​    发送成功后刷新私信列表</p>
<p>设置已读</p>
<p>​    访问私信详情时，将显示的私信设置为已读状态</p>
<p><strong>新增消息 </strong>+ <strong>修改消息的状态</strong>（修改对话框里的所有信息）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>&quot;ids&quot; item<span class="hljs-operator">=</span>&quot;id&quot; <span class="hljs-keyword">open</span><span class="hljs-operator">=</span>&quot;(&quot; separator<span class="hljs-operator">=</span>&quot;,&quot; <span class="hljs-keyword">close</span><span class="hljs-operator">=</span>&quot;)&quot;<span class="hljs-operator">&gt;</span><br>    #&#123;id&#125;<br><span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>
<p>拼接所有的id</p>
<h2 id="统一处理异常"><a href="#统一处理异常" class="headerlink" title="统一处理异常"></a>统一处理异常</h2><p>@ControllerAdvice</p>
<p>​    用于修饰类，表示该类是Controller的全局配置类</p>
<p>​    在此类中，可以对Controller进行如下三种全局配置：异常处理方案、绑定数据方案、绑定参数方案</p>
<p>@ExceptionHandler</p>
<p>​    用于修饰方法，该方法会在Controller出现异常后被调用，用于处理捕获到的异常</p>
<p>@ModelAttribute</p>
<p>​    用于修饰方法，该方法会在Controller方法执行前被调用，用于为Moder对象绑定参数</p>
<p>@DataBinder</p>
<p>​    用于修饰方法，该方法会在Controller方法执行前被调用，用于绑定参数的转换器</p>
<p>异步就是json，存储中间信息待处理，同步就是直接返回给你个html。</p>
<h2 id="统一纪录日志"><a href="#统一纪录日志" class="headerlink" title="统一纪录日志"></a>统一纪录日志</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-01 at 17.11.11.png" srcset="/img/loading.gif" lazyload alt="AOP"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-01 at 17.12.06.png" srcset="/img/loading.gif" lazyload alt="AOP织入"></p>
<p>pointcut 植入点 （在哪里放入）</p>
<p>advice 通知 （具体逻辑）</p>
<p>Spring AOP在【运行时】通过代理的方式织入代码，只支持方法类型的连接点。</p>
<p>Spring AOP限制了连接点必须是方法执行级别</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-01 at 17.17.55.png" srcset="/img/loading.gif" lazyload alt="Spring AOP"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.nowcoder.community.aspect;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.*;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">//@Component</span><br><span class="hljs-comment">//@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlphaAspect</span> &#123;<br><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.nowcoder.community.service.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Before(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;before&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@After(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;after&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterReturning(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterRetuning</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;afterRetuning&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterThrowing(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowing</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;afterThrowing&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;around before&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> joinPoint.proceed();<br>        System.out.println(<span class="hljs-string">&quot;around after&quot;</span>);<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h1 id="第4章-Redis，一站式高性能存储方案"><a href="#第4章-Redis，一站式高性能存储方案" class="headerlink" title="第4章 Redis，一站式高性能存储方案"></a>第4章 Redis，一站式高性能存储方案</h1><h2 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h2><p>Redis是一款基于键值对的NoSQL数据库，它的值支持多种数据结构：</p>
<p>字符串（strings）、哈希（hashes）、列表（lists）、集合（sets）、有序集合（sorted sets）等</p>
<p>Redis将所有的数据都存放在内存中，所以它的读写性能十分惊人</p>
<p>同时，Redis还可以将内存中的数据存放在内存中，所以的它的读写性能十分惊人</p>
<p>Redis典型的应用场景包括：缓存、排行榜、计数器、社交网络、消息队列等。</p>
<h2 id="Spring整合Redis"><a href="#Spring整合Redis" class="headerlink" title="Spring整合Redis"></a>Spring整合Redis</h2><p>引入依赖</p>
<p>​    spring-boot-starter-data-redis</p>
<p>配置Redis</p>
<p>​    配置数据库参数</p>
<p>​    编写配置类，构造RedisTemplate</p>
<p>访问Redis</p>
<p>​    redisTemplate.opsForValue()</p>
<p>​    redisTemplate.opsForHash()</p>
<p>​    redisTemplate.opsForList()</p>
<p>​    redisTemplate.opsForSet()</p>
<p>​    redisTemplate.opsForZSet()</p>
<p>spring整合包可以不用写版本号他们互相自动兼容</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 第一行为选哪个库，这三个必须配置</span><br><span class="hljs-attr">spring.redis.database</span>=<span class="hljs-string">11 </span><br><span class="hljs-attr">spring.redis.host</span>=<span class="hljs-string">localhost</span><br><span class="hljs-attr">spring.redis.post</span>=<span class="hljs-string">6379</span><br></code></pre></td></tr></table></figure>
<p>链接工厂注入到redisTemplate中</p>
<p>Spring容器在创建这个Bean的时候，看到它依赖其他的Bean就会自动注入，这个参数实际上就是依赖的体现。</p>
<h2 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h2><p>点赞</p>
<p>​    支持对帖子、评论点赞</p>
<p>​    第一次点赞、第二次取消点赞</p>
<p>首页点赞数量</p>
<p>​    统计帖子的点赞数量</p>
<p>详情页点赞数量</p>
<p>​    统计点赞数量</p>
<p>​    显示点赞状态</p>
<p>用set类型存储点赞的关系，通过A_B来拼接，然后同时用redis的事务存储string类型的被点赞的用户也就是tostring然后用increment来自增。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// userId是否在这个集合里面，集合的名字是entityLikeKey，userId是他的value</span><br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">isMember</span> <span class="hljs-operator">=</span> operations.opsForSet().isMember(entityLikeKey, userId);<br><br>                operations.multi();<br><br>                <span class="hljs-keyword">if</span> (isMember) &#123;<br>                    operations.opsForSet().remove(entityLikeKey, userId);<br>                    operations.opsForValue().decrement(userLikeKey);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    operations.opsForSet().add(entityLikeKey, userId);<br>                    operations.opsForValue().increment(userLikeKey);<br>                &#125;<br><br>                <span class="hljs-keyword">return</span> operations.exec();<br></code></pre></td></tr></table></figure></p>
<p>k是like:entity:entityType:entityId，v是set(userId)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 某个实体的赞</span><br>    <span class="hljs-comment">// like:entity:entityType:entityId -&gt; set(userId)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getEntityLikeKey</span><span class="hljs-params">(<span class="hljs-type">int</span> entityType, <span class="hljs-type">int</span> entityId)</span> &#123;<br>        <span class="hljs-keyword">return</span> PREFIX_ENTITY_LIKE + SPLIT + entityType + SPLIT + entityId;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>在集合中表达一种无向图的关系。</p>
<h2 id="我收到的点赞"><a href="#我收到的点赞" class="headerlink" title="我收到的点赞"></a>我收到的点赞</h2><p>重构点赞功能</p>
<p>​    以用户为key，记录点赞数量</p>
<p>​    increment(key)，decrement(key)</p>
<p>开发个人主页</p>
<p>​    以用户为key，查询点赞数量</p>
<p>redis 中不能保持原子性 （运行时）一般是因为合格value 是一个字母， 但是你进行了 incre 操作， 这样会导致在事务内部该语句出错， 因为redis 不会判断这句语法是否有问题， 只能等到exec 之后才能报出， 这样的话就会出现原子性问题。 只不过redis 给出的解决方案是程序员要保证你输入是没有问题的， 因此我觉得老师在这里的写法没有问题。 针对另外一种原子性， 也就是语法错误的情况下， 是会都不运行的， 立即报错， 但是用java 来说一般不会出现。 </p>
<p>（点赞没有进行持久化以后可以优化）</p>
<p>直接找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 查询某实体点赞的数量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">findEntityLikeCount</span><span class="hljs-params">(<span class="hljs-type">int</span> entityType, <span class="hljs-type">int</span> entityId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">entityLikeKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getEntityLikeKey(entityType, entityId);<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForSet().size(entityLikeKey);<br>    &#125;<br><br><span class="hljs-comment">// 查询某人对某实体的点赞状态</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">findEntityLikeStatus</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-type">int</span> entityType, <span class="hljs-type">int</span> entityId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">entityLikeKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getEntityLikeKey(entityType, entityId);<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForSet().isMember(entityLikeKey, userId) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 数量</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">likeCount</span> <span class="hljs-operator">=</span> likeService.findEntityLikeCount(entityType, entityId);<br>        <span class="hljs-comment">// 状态</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">likeStatus</span> <span class="hljs-operator">=</span> likeService.findEntityLikeStatus(user.getId(), entityType, entityId);<br></code></pre></td></tr></table></figure>
<p>entityType, entityId 合并就是 entityLikeKey</p>
<h2 id="关注、取消关注"><a href="#关注、取消关注" class="headerlink" title="关注、取消关注"></a>关注、取消关注</h2><p>需求</p>
<p>​    开发关注、取消关注功能</p>
<p>​    统计用户的关注数、粉丝数</p>
<p>关键</p>
<p>​    若A关注B，则A是B的Follower（粉丝），B是A的Followee（目标）。</p>
<p>​    关注的目标可以是用户、帖子、题目等，在实现时将这些目标抽象为实体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 某个用户关注的实体</span><br>    <span class="hljs-comment">// followee:userId:entityType -&gt; zset(entityId,now)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getFolloweeKey</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-type">int</span> entityType)</span> &#123;<br>        <span class="hljs-keyword">return</span> PREFIX_FOLLOWEE + SPLIT + userId + SPLIT + entityType;<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>体现用户和实体的关系，通过时间排序。zset排序。</p>
<p>他拆开了关注和被关注列表</p>
<p><strong>zset的结构：</strong></p>
<p>key：指定一个键名；<br>score：分数值，用来描述 member，它是实现排序的关键；<br>member：要添加的成员（元素）。</p>
<p>zset常用指令<a target="_blank" rel="noopener" href="http://c.biancheng.net/redis/sorted-set.html">http://c.biancheng.net/redis/sorted-set.html</a></p>
<h2 id="关注列表、粉丝列表"><a href="#关注列表、粉丝列表" class="headerlink" title="关注列表、粉丝列表"></a>关注列表、粉丝列表</h2><p>业务层</p>
<p>​    查询某个用户关注的人，支持分页</p>
<p>​    查询某个用户的粉丝，支持分页</p>
<p>表现层</p>
<p>​    处理“查询关注的人”、“查询粉丝”请求。</p>
<p>​    编写“查询关注的人”、“查询粉丝”模版。</p>
<p>zSet对比Set可以排序，可以按照关注的时间进行排序（因为本身默认从高到低就是越新的越高，越靠前），所以取出来的就是这样正确的排行。之前我go写的那个是用默认id来判断的，其实也可以哈哈哈哈我很聪明。</p>
<h2 id="优化登陆模块"><a href="#优化登陆模块" class="headerlink" title="优化登陆模块"></a>优化登陆模块</h2><p>使用Redis存储验证码</p>
<p>​    验证码需要频繁的访问与刷新，对性能要求较高</p>
<p>​    验证码不需永久保存，通常在很短的时间后就会失效（session不能失效）</p>
<p>​    分布式部署时，存在session问题</p>
<p>使用Redis存储登陆凭证</p>
<p>​    处理每次请求时，都要查询用户的登录凭证，访问的频率非常高（原来是mysql里面，压力大）</p>
<p>使用Redis缓存用户信息</p>
<p>​    处理每次请求时，都要根据凭证查询用户信息，访问的频率非常高（用户信息，每次在mysql里面，压力大）</p>
<ul>
<li>Cookie保存在客户端浏览器，Session保存在服务器。</li>
<li>Cookie可以设置过期时间。<ul>
<li><strong>如果Cookie不包含到期日期，则可视为会话Cookie（Session Cookie）</strong>。会话Cookie存储在客户端的内存（浏览器占用的内存）中，决不会写入磁盘。当浏览器关闭时，Cookie将从此永久丢失。</li>
<li><strong>如果Cookie包含到期日期，则可视为持久性Cookie，存储在客户端的磁盘中</strong>。在指定的到期日期，Cookie将从磁盘中删除。</li>
</ul>
</li>
<li><strong>客户端请求服务端时，如果客户端的Cookie中没有当前会话的SessionId，则服务端会新分配一个Session，同时通过算法生成一个唯一的（不重复的）sessionId，并将与该Session对应的SessionId存到Cookie中发回给客户端浏览器。</strong></li>
<li>由于大部分的网站在发回SessionId时使用了会话Cookie（即没有设置过期时间），导致该Cookie存在客户端内存中，所以关闭浏览器即丢失了SessionId信息，再次访问服务端时才找不到对应的Session，于是才有了“关闭浏览器则Session过期”的说法！</li>
<li>服务端在保存Session时也可以设置该Session的过期时间，服务端的Web服务容器通常也有一个默认的过期时间。若访问服务器后，保持不关闭浏览器一段时间，超过Session过期时间后再次访问，会发现依然Session过期找不到了（比如表现为跳转到登录页面），则是“没有关浏览器但Session过期了”！</li>
<li><strong>当（存放着SessionId的）Cookie和Session中两者有任一过期，即宣告会话过期。</strong></li>
</ul>
<p><strong>验证码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 验证码的归属</span><br><span class="hljs-type">String</span> <span class="hljs-variable">kaptchaOwner</span> <span class="hljs-operator">=</span> CommunityUtil.generateUUID();<br><span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;kaptchaOwner&quot;</span>, kaptchaOwner);<br><span class="hljs-comment">// cookie 60s失效</span><br>cookie.setMaxAge(<span class="hljs-number">60</span>);<br><span class="hljs-comment">// cookie 生效的路径</span><br>cookie.setPath(contextPath);<br>response.addCookie(cookie);<br><span class="hljs-comment">// 将验证码存入Redis</span><br><span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getKaptchaKey(kaptchaOwner);<br><span class="hljs-comment">// redis中也是60s失效</span><br>redisTemplate.opsForValue().set(redisKey, text, <span class="hljs-number">60</span>, TimeUnit.SECONDS);<br></code></pre></td></tr></table></figure>
<p>原来从session中取，现在从redis中取。原来是持久化到session中（maybe 有过期时间）现在是存在redis里面设置了过期时间，但不同的是redis的访问效率高。</p>
<p>kaptchaOwner是一个用户的身份，由服务端颁发给浏览器的。它是密文的（如果裸露在外面你的user信息都不好），这样安全。</p>
<p>其中“@Deprecated”意在——-这个方法或类不再建议使用。在新版本中有其他方法或类可以代替这个使用，以后的版本也不会再更新这个方法或类</p>
<p>旁路缓存模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1.优先从缓存中取值</span><br><span class="hljs-keyword">private</span> User <span class="hljs-title function_">getCache</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getUserKey(userId);<br>    <span class="hljs-keyword">return</span> (User) redisTemplate.opsForValue().get(redisKey);<br>&#125;<br><br><span class="hljs-comment">// 2.取不到时初始化缓存数据</span><br><span class="hljs-keyword">private</span> User <span class="hljs-title function_">initCache</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(userId);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getUserKey(userId);<br>    redisTemplate.opsForValue().set(redisKey, user, <span class="hljs-number">3600</span>, TimeUnit.SECONDS);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br><br><span class="hljs-comment">// 3.数据变更时清除缓存数据</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCache</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> RedisKeyUtil.getUserKey(userId);<br>    redisTemplate.delete(redisKey);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Q1: 关键来了，为什么要删除cache，而不是更新cache呢？</strong></p>
<p>主要原因有两个：</p>
<p><strong>1、对服务端资源造成浪费：</strong>删除cache更直接，第一，相比更新cache存放的一些数据需要服务端通过计算得出，会消耗服务端的资源（更新就会消耗计算资源，比如hash存储，你得计算他在哪个位置吧？）；第二呢，因为你这么更新同步的话很可能cache中的数据进入cache后还没有被访问的就已经被删除了，妥妥的浪费。</p>
<p><strong>2、产生数据不一致的问题：</strong>并发场景下，更新cache产生数据不一致性问题的概率更大。</p>
<p><strong>Q2: 在写数据的过程中，可以先删除cache后更新db吗？</strong></p>
<p>不行的，因为数据的持久化是在db中做的，你要以db为标准，所以只有先更新了db以后，确认了某些数据更新了你才能删除之前的cache，这些cache才算是过去式了。</p>
<p>举个例子，请求1先写数据A，请求2随后读数据A的话，就会产生不一致的问题。</p>
<p>1、请求1先将cache中的A数据删除；</p>
<p>2、请求2从db中读取数据；</p>
<p>3、请求1再把db中的A数据更新；</p>
<p>这会导致请求2读取到的是旧值。</p>
<p><strong>Q3: 在写数据的过程中，先更新db，后删除cache就没有问题了吗？</strong></p>
<p>理论上是会出现数据不一致，概率小，因为缓存的写入速度是比数据库的写入速度快很多。所以你先删了缓存没有用，你还是会刷新到旧值。</p>
<p><strong>Q4: Cache Aside Pattern的缺陷</strong></p>
<p><strong>缺陷1: 首次请求数据一定不在cache的问题</strong></p>
<p>解决办法：将热点数据提前放入cache中（提前准备热点数据）</p>
<p><strong>缺陷2: 写操作比较频繁的话导致cache中的数据会被频繁被删除，这样会影响缓存命中率</strong></p>
<h1 id="第5章-Kafka，构建TB级异步消息系统"><a href="#第5章-Kafka，构建TB级异步消息系统" class="headerlink" title="第5章 Kafka，构建TB级异步消息系统"></a>第5章 Kafka，构建TB级异步消息系统</h1><h2 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h2><p>BlockingQueue</p>
<p>​    解决线程通信的问题</p>
<p>​    阻塞方法：put、take</p>
<p>生产者消费者模式</p>
<p>​    生产者：产生数据的线程</p>
<p>​    消息者：使用数据的线程</p>
<p>实现类</p>
<p>​    ArrayBlockingQueue</p>
<p>​    LinkedBlockingQueue</p>
<p>​    PriorityBlockingQueue、SynchronousQueue、DelayQueue等</p>
<p>消费者的消费能力一般不如生产者猛</p>
<h2 id="Kafka入门"><a href="#Kafka入门" class="headerlink" title="Kafka入门"></a>Kafka入门</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-06 at 17.33.09.png" srcset="/img/loading.gif" lazyload alt="Kafka入门"></p>
<p>消息队列大概的两种模式：</p>
<p><strong>观察者模式</strong></p>
<p>通知所有人</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/567e4179118647d59f000763a3bc5046~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" srcset="/img/loading.gif" lazyload alt="观察者.jpg"></p>
<p><strong>发布订阅模式（kafka）</strong></p>
<p>通知订阅的人</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19b670df6cb54c4ebdc17a114b5dc97c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" srcset="/img/loading.gif" lazyload alt="发布订阅.jpg"></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6978728619782701087">https://juejin.cn/post/6978728619782701087</a> 文章讲解</p>
<p>消息持久化到硬盘里面。</p>
<p>Broker：kafka的一台服务器就是一个broker</p>
<p>Zookeeper：管理集群</p>
<p>Topic：生产者发布消息的位置（一个文件夹）</p>
<p>Partition：对于topic位置的分区（提高并发能力）</p>
<p>Offset：在分区内的索引</p>
<p>Leader Replica：对于数据的备份（能力更强，提高容错率）</p>
<p>Follower Replica：对于数据的备份（提高容错率）</p>
<p>Leader和Follower就是主从。</p>
<p>kafka的安装与使用<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1780636">https://cloud.tencent.com/developer/article/1780636</a></p>
<p><strong>关于Kafka使用的重要提示</strong><br>现象：在windows的命令行里启动kafka之后，当关闭命令行窗口时，就会强制关闭kafka。这种关闭方式为暴力关闭，很可能会导致kafka无法完成对日志文件的解锁。届时，再次启动kafka的时候，就会提示日志文件被锁，无法成功启动。<br>方案：将kafka的日志文件全部删除，再次启动即可。<br>建议：不要暴力关闭kafka，建议通过在命令行执行kafka-server-stop命令来关闭它。<br>其他：将来在Linux上部署kafka之后，采用后台运行的方式，就会避免这样的问题。</p>
<h2 id="Spring整合Kafka"><a href="#Spring整合Kafka" class="headerlink" title="Spring整合Kafka"></a>Spring整合Kafka</h2><p>引入依赖</p>
<p>​    spring-kafka</p>
<p>配置Kafka</p>
<p>​    配置server、consumer</p>
<p>访问Kafka</p>
<p>​    生产者</p>
<p>​        kafkaTemplate.send(topic，data)；</p>
<p>​    消费者</p>
<p>​        @KafkaListener(topics = {“test”})</p>
<p>​        public void handleMessage(ConsumerRecord record) {}</p>
<p>有时候，你想在容器中使用主机上的某个目录，你可以通过其它的参数来指定（译者注：注意冒号前面的和后面的内容）：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -v <span class="hljs-regexp">/host/</span>path:<span class="hljs-regexp">/some/</span>path ...<br></code></pre></td></tr></table></figure>
<p>这明确地告诉Docker使用指定的主机路径来代替Docker自己创建的根路径并挂载到容器内指定的路径（以上例子为<code>/some/path</code>）。需要注意的是，这种方式同样支持文件。在Docker术语中，这通常被称为bind-mounts（虽然技术层面上是这样讲的，但是实际的感觉是所有的Volume都是bind-mounts的）。如果主机上的路径不存在，目录将自动在给定的路径中创建。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7100071216727195684">https://juejin.cn/post/7100071216727195684</a> arm下kafka的homebrew安装路径，还有启动kafka</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># zookeeper</span><br>brew services start zookeeper<br>brew services stop zookeeper<br>brew services info zookeeper<br><br><span class="hljs-comment">#kafka</span><br>brew services start kafka<br>brew services stop kafka<br>brew services info kafka<br></code></pre></td></tr></table></figure>
<h2 id="发送系统通知"><a href="#发送系统通知" class="headerlink" title="发送系统通知"></a>发送系统通知</h2><p>触发事件</p>
<p>​    评论后，发布通知</p>
<p>​    点赞后，发布通知</p>
<p>​    关注后，发布通知</p>
<p>处理事件</p>
<p>​    封装事件对象</p>
<p>​    开发事件的生产者</p>
<p>​    开发事件的消费者</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-08 at 15.25.19.png" srcset="/img/loading.gif" lazyload alt="Screen Shot 2022-12-08 at 15.25.19"></p>
<p>事件的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String topic;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> userId;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> entityType;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> entityId;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> entityUserId;<br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>kafka的topic和partition</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Dongguabai/article/details/86536894">https://blog.csdn.net/Dongguabai/article/details/86536894</a></p>
<p>造一个虚拟用户发消息，固定了管它叫系统管理员。</p>
<p>@KafkaListener标注消费者要消费的topic</p>
<p>messageController来接收消息，统一处理</p>
<p>这里只用到了kafka的<strong>异步</strong>的特性</p>
<p>EventConsumer类自己接收kafka消息因为有@KafkaListener标记</p>
<h2 id="显示系统通知"><a href="#显示系统通知" class="headerlink" title="显示系统通知"></a>显示系统通知</h2><p>通知列表</p>
<p>​    显示评论、点赞、关注三种类型的通知</p>
<p>通知详情</p>
<p>​    分页显示某一类主题所包含的通知</p>
<p>未读消息</p>
<p>​    在页面头部显示所有的未读消息数量</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-08 at 19.31.17.png" srcset="/img/loading.gif" lazyload alt="三种通知"></p>
<p>拦截器是切面在所有的handle中</p>
<p>而AOP是切面在所有的代码中，不同的mvc层中</p>
<h1 id="第6章-Elasticsearch，分布式搜索引擎"><a href="#第6章-Elasticsearch，分布式搜索引擎" class="headerlink" title="第6章 Elasticsearch，分布式搜索引擎"></a>第6章 Elasticsearch，分布式搜索引擎</h1><h2 id="Elasticsearch入门"><a href="#Elasticsearch入门" class="headerlink" title="Elasticsearch入门"></a>Elasticsearch入门</h2><p>Elasticsearch简介（可以看成一种带搜索引擎的数据库）</p>
<p>​    一个分布式的、Restful风格的搜索引擎</p>
<p>​    支持对各种类型的数据的检索</p>
<p>​    搜索速度快，可以提供实时的搜索服务</p>
<p>​    便于水平扩展，每秒可以处理PB级海量数据</p>
<p>Elasticsearch术语</p>
<p>​    索引（DB）、类型（table）、文档（json）、字段</p>
<p>​    集群、节点、分片、副本</p>
<p>6.0以后计划废弃了类型，直接索引直接对应表，7.0彻底废弃了类型。</p>
<p>最好是用6.4.3和springboot内置的一致</p>
<p>默认英文分词，所以需要个中文分词的插件</p>
<p>安装相关<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/257867352">https://zhuanlan.zhihu.com/p/257867352</a></p>
<p>通过json来交互</p>
<p><code>docker run -d --name es -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; + $&#123;imageID&#125;</code></p>
<p><strong>关于ES配置的重要提示</strong><br>ES在启动时，默认申请1g内存，在学习阶段，这太耗内存了，可以调小一点。大家可以修改其config目录下的jvm.options文件，将初识内存调整为256m，将最大内存调整为512m，如下图：<br><img src="https://uploadfiles.nowcoder.com/images/20190806/5175351_1565065069370_4A47A0DB6E60853DEDFCFDF08A5CA249" srcset="/img/loading.gif" lazyload alt="图片说明"></p>
<h2 id="Spring整合Elasticsearch"><a href="#Spring整合Elasticsearch" class="headerlink" title="Spring整合Elasticsearch"></a>Spring整合Elasticsearch</h2><p>引入依赖</p>
<p>​    spring-boot-start-data-elasticsearch</p>
<p>配置Elasticsearch</p>
<p>​    cluster-name、cluster-nodes</p>
<p>Spring Data Elasticsearch</p>
<p>​    ElasticsearchTemplate</p>
<p>​    ElasticsearchRepository</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/icanlove/article/details/125636857查询集群信息">https://blog.csdn.net/icanlove/article/details/125636857查询集群信息</a></p>
<p>9200 是http端口 9300 是tcp端口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Document(indexName = &quot;discusspost&quot;, type = &quot;_doc&quot;, shards = 6, replicas = 3)</span><br></code></pre></td></tr></table></figure>
<p>shard 分片</p>
<p>replicas 副本</p>
<h2 id="开发社区搜索功能"><a href="#开发社区搜索功能" class="headerlink" title="开发社区搜索功能"></a>开发社区搜索功能</h2><p>搜索服务</p>
<p>​    将帖子保存至Elasticsearch服务器</p>
<p>​    从Elasticsearch服务器删除帖子</p>
<p>​    从Elasticsearch服务器搜索帖子</p>
<p>发布事件</p>
<p>​    发布帖子时，将帖子异步的提交到Elasticsearch服务器</p>
<p>​    增加评论时，将帖子异步的提交到Elasticsearch服务器</p>
<p>​    在消费组建中增加一个方法，消费帖子发布事件</p>
<p>显示结果</p>
<p>​    在控制器中处理搜索请求，在HTML上显示搜索结果</p>
<p>评论和发帖子都会修改es里面的帖子的数据。</p>
<h1 id="第7章-项目进阶，构建安全高效的企业服务"><a href="#第7章-项目进阶，构建安全高效的企业服务" class="headerlink" title="第7章 项目进阶，构建安全高效的企业服务"></a>第7章 项目进阶，构建安全高效的企业服务</h1><h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><p>简介</p>
<p>​    Spring Security 是一个专注于为Java应用程序提供身份认证和授权的框架，它的强大之处在于它可以轻松扩展以满足自定义的需求</p>
<p>特征</p>
<p>​    对身份的认证和授权提供全面的、可扩展的支持。</p>
<p>​    防止各种攻击，如会话固定攻击、点击劫持、csrf攻击等。</p>
<p>​    支持与Servlet API、Spring MVC等Web技术集成。</p>
<p>springMVC的核心组件是DispatcherServlet一个中心（满足javaEE规范）。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-15 at 15.59.00.png" srcset="/img/loading.gif" lazyload alt="springMVC"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-15 at 18.40.06.png" srcset="/img/loading.gif" lazyload alt="providerManager"></p>
<p>authentication是用于封装认证信息的接口</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-16 at 13.51.57.png" srcset="/img/loading.gif" lazyload alt="spring-security"></p>
<p>在authenticate里面填写用户登录逻辑</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-16 at 14.03.51.png" srcset="/img/loading.gif" lazyload alt="登陆相关配置"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-16 at 14.16.23.png" srcset="/img/loading.gif" lazyload alt="接上面">直接重写掉configure，这样就避免使用默认的登陆页面。</p>
<p>重定向举例：删除模块A要跳转到查询模块B，不能由函数A直接返回B的路径，这样就让A和B粘在一起了，所以要重定向。</p>
<p>转发：就是要A依赖B模块就需要转发。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-16 at 14.29.02.png" srcset="/img/loading.gif" lazyload alt="filter"></p>
<p>在filter里面处理验证码。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-16 at 14.30.11.png" srcset="/img/loading.gif" lazyload alt="记住我"></p>
<p>记住我</p>
<h2 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h2><p>登陆检查</p>
<p>​    之前采用拦截器实现了登陆检查，这是简单的权限管理方案，现在将其废用</p>
<p>授权配置</p>
<p>​    对当前系统内包含的所有的请求，分配访问权限（普通用户、版主、管理员）</p>
<p>认证方案</p>
<p>​    绕过Security认证流程，采用系统原来的认证方案</p>
<p>CSRF配置</p>
<p>​    防止CSRF攻击的基本原理，以及表单、AJAX相关的配置</p>
<p><strong>Q：老师，执行完/logout中的clearContext后，后面在afterComplete方法时还会再次执行clearContext，那还有必要在/logout中ClearContext吗？麻烦老师详细的解答一下</strong></p>
<ol>
<li><p>Security提供了认证和授权两个功能，我们在DEMO里也做了演示，而在项目中应用时，我们并没有使用它的 认证功能，而单独的使用了它的授权功能，所以需要对认证的环节做一下特殊的处理，以保证授权的正常进行；</p>
</li>
<li><p>Security的所有功能，都是基于Filter实现的，而Filter的执行早于Interceptor和Controller，关于Security的拦截器原理，可以参考<a target="_blank" rel="noopener" href="http://www.spring4all.com/article/458；">http://www.spring4all.com/article/458；</a></p>
</li>
<li>我们的解决方案是，在Interceptor中判断登录与否，然后人为的将认证结果添加到了SecurityContextHolder里。这里要注意，由于Interceptor执行晚于Filter，所以认证的进行依赖于前一次请求的拦截器处理。比如，我登录成功了，然后请求自行重定向到了首页。在访问首页时，认证Filter其实没起作用，因为这个请求不需要权限，然后执行了Interceptor，此时才将认证结果加入SecurityContextHolder，这时你再访问/letter/list，可以成功，因为在这次请求里，Filter根据刚才的认证结果，判断出来你有了权限；</li>
<li>退出时，需要将SecurityContextHolder里面的认证结果清理掉，这样下次请求时，Filter才能正确识别用户的权限；</li>
<li>LoginTicketInterceptor中的afterCompletion中其实不用清理SecurityContextHolder，将这句话删掉。</li>
</ol>
<p>不是的兄弟，你理解错了，比如你没有登录然后直接访问user页面，会因为没有权限被重定向到登录页面，输入账号密码点击登录按钮那一刻发起登录请求，先经过filter，但因为security没有拦截login请求，所以通过，再经过LoginTicketInterceptor，此时还没执行到登录的业务，preHandle里那个if(ticket!=null)为false，也就是cookie里没有ticket凭证，SecurityContextHolder也不会存东西，之后才到登录controller执行登录业务，主要就是在cookie里存凭证，登录请求结束后回重定向到首页，也就是重新发起了一次请求，同样会先经过filter，此时SecurityContextHolder里也是没东西的，但因为security配置类并没有拦截首页index请求，所以通过filter进入LoginTicketInterceptor，此时if(ticket!=null)为true，才会执行if体里的hostHolder和存SecurityContextHolder，这才算认证成功，也就是老师所说的“认证的进行依赖于前一次请求的拦截器处理”，这时你再访问/letter/list，可以成功，因为在这次请求里，Filter根据刚才的认证结果，判断出来你有了权限；</p>
<p>说白了就是你登陆的同时才会进行认证。</p>
<p><strong>CSRF跨域攻击</strong></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-17 at 16.59.55.png" srcset="/img/loading.gif" lazyload alt="CSRF"></p>
<p>钓鱼网站穿你衣服用你的cookie ticket来进行请求。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-17 at 17.01.06.png" srcset="/img/loading.gif" lazyload alt="CSRF解决方案"></p>
<p>他多发给第一个请求的浏览器token，这样就就有了保险。具体是怎么样实现的呢。比如提交一个表单，你先会得到一个页面，然后这个页面里面会在表单form的位置内嵌入一个token作为保险认证（CSRF凭证），但是这个认证x网站是没有的，因为他没有这个页面。所以由此做出了身份认证的区分。</p>
<h2 id="置顶、加精、删除"><a href="#置顶、加精、删除" class="headerlink" title="置顶、加精、删除"></a>置顶、加精、删除</h2><p>功能实现</p>
<p>​    点击置顶，修改帖子的类型</p>
<p>​    点击“加精”、“删除”，修改帖子的状态</p>
<p>权限管理</p>
<p>​    版主可以执行“置顶”、“加精”操作</p>
<p>​    管理员可以执行“删除”操作。</p>
<p>按钮显示</p>
<p>​    版主可以看到“置顶”、“加精”按钮</p>
<p>​    管理员可以看到“删除”按钮</p>
<p>@<em>ResponseBody</em>的作用其实是将java对象转为json格式的数据。</p>
<p>可以看到我们传递是一个User，但是经过@ResponseBody的作用后直接转成了json格式，给了我们很大的便利，如果没有这个转化的话，我们前台得到的是Object对象。实现异步请求。</p>
<h2 id="Redis高级数据类型"><a href="#Redis高级数据类型" class="headerlink" title="Redis高级数据类型"></a>Redis高级数据类型</h2><p>HyperLogLog</p>
<p>​    采用一种基数算法，用于完成独立总数的统计</p>
<p>​    占据空间小，无论统计多少个数据，只占12K的内存空间</p>
<p>​    不精确的统计算法，标准误差为0.81%</p>
<p>​    size()获取去重的数据，union()集合了几个hyperloglog</p>
<p>Bitmap</p>
<p>​    不是一种独立的数据结构，实际上就是字符串</p>
<p>​    支持按位存取数据，可以将其看成是byte数组</p>
<p>​    适合存储索大量的连续的数据的布尔值</p>
<h2 id="网站数据统计"><a href="#网站数据统计" class="headerlink" title="网站数据统计"></a>网站数据统计</h2><p>UV（Unique Visitor）</p>
<p>​    独立访客，需通过用户IP排重统计数据</p>
<p>​    每次访问都要进行统计</p>
<p>​    HyperLogLog，性能好，且存储空间小</p>
<p>DAU（Daily Active User）</p>
<p>​    日活跃用户，需通过用户ID排重统计数据</p>
<p>​    访问过一次，则认为其活跃</p>
<p>​    Bitmap，性能好、且可以统计精确的结果</p>
<h2 id="任务执行和调度"><a href="#任务执行和调度" class="headerlink" title="任务执行和调度"></a>任务执行和调度</h2><p>JDK 线程池</p>
<p>​    ExecutorService</p>
<p>​    ScheduledExecutorService</p>
<p>Spring线程池</p>
<p>​    ThreadPoolTaskExecutor</p>
<p>​    ThreadPoolTaskScheduler</p>
<p>分布式定时任务</p>
<p>​    Spring Quartz（通过数据库数据的共享）</p>
<p><strong>Quartz</strong></p>
<p>Scheduler 核心的调度工具</p>
<p>JobDetail 配置job</p>
<p>Trigger 触发器配置job什么时候运行</p>
<h2 id="热贴排行"><a href="#热贴排行" class="headerlink" title="热贴排行"></a>热贴排行</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-18 at 20.02.08.png" srcset="/img/loading.gif" lazyload alt="热贴排名"></p>
<p>在点赞加精评论的时候，将分数变化的帖子放入缓存redis（用set数据结构，避免重复），然后再计算。</p>
<p>这个就是主要改变的点击最热还是最新</p>
<h2 id="将文件上传至云服务器"><a href="#将文件上传至云服务器" class="headerlink" title="将文件上传至云服务器"></a>将文件上传至云服务器</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-18 at 22.40.15.png" srcset="/img/loading.gif" lazyload alt="文件上传至云服务器"></p>
<p>AccessKey 代表你的身份，你有权限</p>
<p>SecretKey 上传内容的时候进行加密</p>
<p>这个就是说那个非对称加密。</p>
<p>/setting里面有凭证，然后带着凭证uploadtoken发出去，通过前端的form来调用/header/url从而进行更新。</p>
<h2 id="优化网站的性能"><a href="#优化网站的性能" class="headerlink" title="优化网站的性能"></a>优化网站的性能</h2><p>本地缓存</p>
<p>​    将数据缓存到应用服务器上，性能最好</p>
<p>​    常用缓存工具：Ehcache、Guava、Caffeine（目前最好的）等</p>
<p>分布式缓存（用来跨服务器）</p>
<p>​    将数据缓存在NoSQL数据库上，跨服务器</p>
<p>​    常用缓存工具：MemCache、Redis等</p>
<p>多级缓存</p>
<p>​    &gt; 一级缓存（本地缓存） &gt; 二级缓存（分布式缓存） &gt; DB</p>
<p>​    避免缓存雪崩（缓存失效，大量请求直接打到DB），提高系统的可用性。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 10.17.05.png" srcset="/img/loading.gif" lazyload alt="本地缓存和分布式缓存的区别"></p>
<p>分布式可以保持一致性但是缺点就是，有网络开销。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 10.19.12.png" srcset="/img/loading.gif" lazyload alt="三级缓存结构"></p>
<p>本地缓存占用内存较小，会通过淘汰机制存储更多的热点数据。避免直接雪崩。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># caffeine</span><br><span class="hljs-attr">caffeine.posts.max-size</span>=<span class="hljs-string">15</span><br><span class="hljs-attr">caffeine.posts.expire-seconds</span>=<span class="hljs-string">180</span><br></code></pre></td></tr></table></figure>
<p>caffeine.${名字}.${属性}</p>
<p>缓存15个帖子，有效时间180s（3分钟）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 初始化帖子列表缓存</span><br>        postListCache = Caffeine.newBuilder()<br>            .maximumSize(maxSize)<br>            .expireAfterWrite(expireSeconds, TimeUnit.SECONDS)<br>            .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, List&lt;DiscussPost&gt;&gt;() &#123;<br>                <span class="hljs-meta">@Nullable</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> List&lt;DiscussPost&gt; <span class="hljs-title function_">load</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> String key)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || key.length() == <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;参数错误!&quot;</span>);<br>                    &#125;<br><br>                    String[] params = key.split(<span class="hljs-string">&quot;:&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (params == <span class="hljs-literal">null</span> || params.length != <span class="hljs-number">2</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;参数错误!&quot;</span>);<br>                    &#125;<br><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> Integer.valueOf(params[<span class="hljs-number">0</span>]);<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> Integer.valueOf(params[<span class="hljs-number">1</span>]);<br><br>                    <span class="hljs-comment">// 二级缓存: Redis -&gt; mysql</span><br><br>                    logger.debug(<span class="hljs-string">&quot;load post list from DB.&quot;</span>);<br>                    <span class="hljs-keyword">return</span> discussPostMapper.selectDiscussPosts(<span class="hljs-number">0</span>, offset, limit, <span class="hljs-number">1</span>);<br>                &#125;<br>            &#125;);<br>        <span class="hljs-comment">// 初始化帖子总数缓存</span><br>        postRowsCache = Caffeine.newBuilder()<br>            .maximumSize(maxSize)<br>            .expireAfterWrite(expireSeconds, TimeUnit.SECONDS)<br>            .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Integer, Integer&gt;() &#123;<br>                <span class="hljs-meta">@Nullable</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">load</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Integer key)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    logger.debug(<span class="hljs-string">&quot;load post rows from DB.&quot;</span>);<br>                    <span class="hljs-keyword">return</span> discussPostMapper.selectDiscussPostRows(key);<br>                &#125;<br>            &#125;);<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>Caffeine 固定的初始化方式</p>
<p>JMeter压力测试环境</p>
<p>200个线程，统一随机定时器（0-1s发出请求），查看聚合报告</p>
<p>（无缓存）吞吐量5.1/sec</p>
<p>（有缓存）吞吐量20.6/sec</p>
<p>提升了4倍的吞吐量</p>
<p>在本节课中老师提到了可以用Caffeine+Redis实现多级缓存来缓存热点帖子，我思考了一下发现，老师使用的是Caffeine中LoadingCache（同步缓存），即多个线程线程访问缓存时，若缓存没有对应的数据，只允许一个线程去数据库中取数据，其他线程则排队等候。由于LoadingCache是线程同步的，所以即使Caffeine中的缓存同时失效了（他会等待把缓存弄好的时候再放开阻塞），有大量请求访问热点帖子的时候，它也不会出现缓存雪崩的问题。因此我认为对于缓存热点帖子这一功能而言，应该只需要用Caffeine做缓存就足够了，可以不使用Redis作二级缓存，毕竟热点贴的更新频率慢。如果有其他合适的需求，可以再考虑使用多级缓存的策略。也希望和其他学习的小伙伴交流一下这个问题。</p>
<p>分布式缓存也可以用但是不一定，看场景，实在不行还可以开启消息队列。</p>
<p>caffeine缓存</p>
<p>资料1<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9a80c662dac4">https://www.jianshu.com/p/9a80c662dac4</a></p>
<p>资料2<a target="_blank" rel="noopener" href="https://www.cnblogs.com/rickiyang/p/11074158.html">https://www.cnblogs.com/rickiyang/p/11074158.html</a></p>
<p>get 方法将一个参数为 key 的 Function (createExpensiveGraph) 作为参数传入。如果缓存中不存在该键，则调用这个 Function 函数，并将返回值作为该缓存的值插入缓存中。get 方法是以阻塞方式执行调用，即使多个线程同时请求该值也只会调用一次Function方法。这样可以避免与其他线程的写入竞争，这也是为什么使用 get 优于 getIfPresent 的原因。</p>
<h1 id="第8章-项目发布与总结"><a href="#第8章-项目发布与总结" class="headerlink" title="第8章 项目发布与总结"></a>第8章 项目发布与总结</h1><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><h2 id="项目监控"><a href="#项目监控" class="headerlink" title="项目监控"></a>项目监控</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 17.05.36.png" srcset="/img/loading.gif" lazyload alt="项目监控"></p>
<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 17.09.18.png" srcset="/img/loading.gif" lazyload alt="项目部署"></p>
<h2 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 17.34.05.png" srcset="/img/loading.gif" lazyload alt="项目总结"></p>
<p>关注一下会话管理 cookie session不用了session（分布式部署的问题）存在redis里面。</p>
<p>事务底层依赖aop？</p>
<p>spring事务和mysql的事务的区别？</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 19.31.48.png" srcset="/img/loading.gif" lazyload alt="架构"></p>
<h2 id="常见面试题"><a href="#常见面试题" class="headerlink" title="常见面试题"></a>常见面试题</h2><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-19 at 19.33.34.png" srcset="/img/loading.gif" lazyload alt="常见面试题"></p>
<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.07.36.png" srcset="/img/loading.gif" lazyload alt="mysql锁"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.10.45.png" srcset="/img/loading.gif" lazyload alt="mysql锁2"></p>
<p>DML就是增删改（Data Manipulation Language 数据操控语言) 用于操作数据库对象对象中包含的数据</p>
<p>DQL就是查询 (Data Query Language 数据查询语言 )用于查询数据</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.13.13.png" srcset="/img/loading.gif" lazyload alt="mysql锁3"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.17.58.png" srcset="/img/loading.gif" lazyload alt="mysql锁4"></p>
<p>A上锁，B也要资源，但我是循环等待A解锁，频率很高，CPU消耗大，其实就是循环非阻塞IO模型。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.35.04.png" srcset="/img/loading.gif" lazyload alt="mysql锁5"></p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.36.59.png" srcset="/img/loading.gif" lazyload alt="redis1"></p>
<p>过期策略</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.37.51.png" srcset="/img/loading.gif" lazyload alt="redis2"></p>
<p><img src="/Users/peterpan/Desktop/Screen Shot 2022-12-21 at 16.38.34.png" srcset="/img/loading.gif" lazyload alt="redis3"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.44.29.png" srcset="/img/loading.gif" lazyload alt="redis4"></p>
<p>缓存穿透（没有命中缓存，直达存储层）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.45.53.png" srcset="/img/loading.gif" lazyload alt="redis5"></p>
<p>缓存击穿（热点失效，到达存储层）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.47.26.png" srcset="/img/loading.gif" lazyload alt="redis6"></p>
<p>缓存雪崩（大量的缓存击穿）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.49.08.png" srcset="/img/loading.gif" lazyload alt="redis7"></p>
<p>分布式锁</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.55.40.png" srcset="/img/loading.gif" lazyload alt="redis8"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.57.51.png" srcset="/img/loading.gif" lazyload alt="redis9"></p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 16.58.37.png" srcset="/img/loading.gif" lazyload alt="redis10"></p>
<p>lua脚本实现分布式锁<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44259720/article/details/121968837">https://blog.csdn.net/weixin_44259720/article/details/121968837</a></p>
<p>lua脚本实现了它本身没有原子性。</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 17.32.57.png" srcset="/img/loading.gif" lazyload alt="redis11"></p>
<h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><p>spring IOC（控制反转，通过减少类之间的耦合，我们只需要编写谁依赖谁就行。这样他bean实例的创建不会重复，占用多余的资源）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 17.36.27.png" srcset="/img/loading.gif" lazyload alt="spring1"></p>
<p>spring AOP（减少耦合的一个统一切面思想）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 17.38.59.png" srcset="/img/loading.gif" lazyload alt="spring2"></p>
<p>spring MVC（就是个mvc架构的调度中心）</p>
<p><img src="/Users/peterpan/Library/Application Support/typora-user-images/Screen Shot 2022-12-21 at 17.39.17.png" srcset="/img/loading.gif" lazyload alt="spring3"></p>
<p>HandlerMapping：应该跟gin框架一样，包含了路由路径</p>
<p>HandlerExecutionChain：包含拦截器和controller，类似中间件的洋葱模型编排，但不执行。具体的执行在5、6、7中？</p>
<p>HandlerAdapter：包含具体的controller的适配器进行执行preHandle（）和postHandler（）就是拦截器的执行，跟代码是同步的。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java-Project/">Java-Project</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/21/%E6%89%8B%E5%86%99grpc/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/17/INTERVIEW/">
                        <span class="hidden-mobile">INTERVIEW</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> & <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  










  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
